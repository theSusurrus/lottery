# Lottery System

The project aims to automate the player drawing process for FNM events organized by Gralnia. The list of players comes from an HTML list generated by Eventlink and is transmitted from the server to a web application hosted on the same server.

# Usage

Server configuration is done through the `config.toml` file. In this file, we provide:
- the address and port on which the server will listen,
- the path from which data for drawing is fetched,
- the folder with hosted files, default is `host/`,
- the home page hosted under the path `/`.

In most cases, it is recommended to set the address and port of a network interface visible from the LAN network on which the application will be accessed. It is also recommended to set a static address or DNS name for the server computer to maintain a stable bookmark on the device conducting the lottery - smartphone, tablet, etc.

Next, open the application on the client device. Assuming we set the address to `192.168.0.1` and port to `3000` in `config.toml`, the URL of the page will be `http://192.168.0.1:3000/`.

# Installation

TBD

# Architecture

## Backend Rust

### Config

The configuration is read from the `config.toml` file. If the configuration fails for any reason, the program panics.

### HTTP Service

The HTTP service starts listening after successful program configuration. The service supports only GET methods, and all paths are relative to the configured folder.

An additional path `/names` returns the current state of the list of players participating in the drawing.

Querying `lottery=new` causes the reading of an HTML file containing the list of players, updating the list of players in memory, and regenerating the `<host>/names.json` file. This file is read by the frontend to import the list of players. All of this happens before sending the response to the client.

### Name Provider

#### Provider

The Provider trait allows for easy exchange of name parsers. The only requirement is the implementation of the `fn get_names(&self) -> Result<Vec<String>, std::io::Error>` function.

#### HTML Provider

Currently, the only implemented provider is the HTML parser from Eventlink `src/names/html.rs`. An example file can be found in `src/test_names.htm`. The parser is designed to find the starting marker and begin adding lines of text until it finds the ending marker.

If, for any reason, the list is shorter than 2, the file does not open, etc., parsing will fail, and an error message will be returned to the client.

## Frontend JS

TBD